@page "/feedback"

@using ServerApp.Data.Entities

@inject IDataService data
@inject NavigationManager NavigationManager
@inject ToastService toastService

<PageTitle>Обратная связь</PageTitle>

<div class="block-group">
    <div class="block-title">
        <div class="block-title-text">Обратная связь</div>
        <div class="form-text">Здесь вы можете оставить нам сообщение</div>
    </div>
    <EditForm Model="feedback" OnValidSubmit="HandleOnValidSubmit" class="block-content-text">
        <DataAnnotationsValidator />

        <div class="form-text">Ваше имя</div>
        <div class="form-input w-100 mb-3">
            <ValidationMessage For="@(() => feedback.Name)" />
            <InputText class="form-control" @bind-Value="feedback.Name" />
        </div>

        <div class="form-text">Электронная почта</div>
        <div class="form-input w-100 mb-3">
            <ValidationMessage For="@(() => feedback.Email)" />
            <InputText class="form-control" @bind-Value="feedback.Email" />
        </div>

        <div class="form-text">Ваше сообщение</div>
        <div class="form-input w-100 mb-3">
            <ValidationMessage For="@(() => feedback.Message)" />
            <InputTextArea class="form-control" @bind-Value="feedback.Message" />
        </div>

        <div class="d-flex justify-content-center">
            <Button Type="ButtonType.Submit"
                    Color="ButtonColor.Primary">
                Отправить
            </Button>
        </div>
    </EditForm>
</div>

@code {
    FeedbackModel feedback = new();

    private async Task HandleOnValidSubmit()
    {
        await data.SaveFeedbackAsync(new FeedBack(){Name = feedback.Name, Email = feedback.Email, Message = feedback.Message});
        toastService.Notify(new(ToastType.Success, "Ваше сообщение успешно отправлено"));
        feedback = new();
    }

    class FeedbackModel
    {
        [Required(ErrorMessage = "Необходимо ввести имя")]
        public string? Name { get; set; }
        [Required(ErrorMessage = "Необходимо ввести адрес электронной почты")]
        [EmailAddress(ErrorMessage = "Указан некорректный адрес электронной почты")]
        public string? Email { get; set; }
        [Required(ErrorMessage = "Необходимо ввести сообщение")]
        public string? Message { get; set; }
    }
}
