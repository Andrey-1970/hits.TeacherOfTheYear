@page "/assessment"

@inject IDataService data
@inject NavigationManager NavigationManager

<PageTitle>Список кандидатов</PageTitle>

<div class="block-group">
    <div class="block-title">
        <div class="block-title-text">
            Список кандидатов
        </div>
    </div>
    <div style="align-items: flex-start; overflow: auto;">
        <Grid TItem="Participant"
              Class="table-filter"
              FiltersRowCssClass="filters-row"
              HeaderRowCssClass="header-row"
              DataProvider="UserDataProvider"
              FiltersTranslationProvider="GridFiltersTranslationProvider"
              AllowFiltering="true"
              AllowPaging="true"
              PageSize="8"
              AllowSorting="true"
              Responsive="true"
              AllowRowClick="true"
              OnRowClick="OnRowClick">

            <GridColumn TItem="Participant" HeaderText="ФИО кандидата" PropertyName="FullName" SortKeySelector="item => item.FullName">
                @context.FullName
            </GridColumn>
            <GridColumn TItem="Participant" HeaderText="Место работы" PropertyName="WorkPlace" SortKeySelector="item => item.WorkPlace">
                @context.WorkPlace
            </GridColumn>
            <GridColumn TItem="Participant" HeaderText="Проверено" PropertyName="CheckStatus" SortKeySelector="item => item.CheckStatus"
                        IsDefaultSortColumn="true" SortDirection="SortDirection.Ascending">
                @if (context.CheckStatus)
                {
                    <div class="text-success">Да</div>
                }
                else
                {
                    <div class="text-danger">Нет</div>
                }
            </GridColumn>
        </Grid>
    </div>
</div>

@code {
    private List<Participant> participants = new();

    protected override void OnInitialized()
    {
        participants.Add(new Participant
            {
                Id = Guid.NewGuid(),
                FullName = "Иванов Иван Иванович",
                WorkPlace = "Тюменский индустриальный университет",
            });
        participants.Add(new Participant
            {
                Id = Guid.NewGuid(),
                FullName = "Петров Петр Петрович",
                WorkPlace = "Тюменский государственный университет",
            });
        participants.Add(new Participant
            {
                Id = Guid.NewGuid(),
                FullName = "Федоров Федор Федорович",
                WorkPlace = "Тюменский государственный институт культуры",
            });
    }

    private async Task<GridDataProviderResult<Participant>> UserDataProvider(GridDataProviderRequest<Participant> request)
    {
        return await Task.FromResult(request.ApplyTo(participants));
    }

    private async Task<IEnumerable<FilterOperatorInfo>> GridFiltersTranslationProvider()
    {
        var filtersTranslation = new List<FilterOperatorInfo>();

        // number/date/boolean
        filtersTranslation.Add(new("=", "Равно", FilterOperator.Equals));
        filtersTranslation.Add(new("!=", "Не равно", FilterOperator.NotEquals));
        // number/date
        filtersTranslation.Add(new("<", "Меньше", FilterOperator.LessThan));
        filtersTranslation.Add(new("<=", "Меньше или равно", FilterOperator.LessThanOrEquals));
        filtersTranslation.Add(new(">", "Больше", FilterOperator.GreaterThan));
        filtersTranslation.Add(new(">=", "Больше или равно", FilterOperator.GreaterThanOrEquals));
        // string
        filtersTranslation.Add(new("*a*", "Включает", FilterOperator.Contains));
        filtersTranslation.Add(new("a**", "Начинается с", FilterOperator.StartsWith));
        filtersTranslation.Add(new("**a", "Заканчивается на", FilterOperator.EndsWith));
        filtersTranslation.Add(new("=", "Равно", FilterOperator.Equals));
        // common
        filtersTranslation.Add(new("x", "Очистить фильтр", FilterOperator.Clear));

        return await Task.FromResult(filtersTranslation);
    }

    private async Task OnRowClick(GridRowEventArgs<Participant> row)
    {
        await Task.Run(() => NavigationManager.NavigateTo($"/assessment/application/{row.Item.Id.ToString()}"));
    }

    private class Participant
    {
        public Guid Id { get; set; }
        public string? FullName { get; set; }
        public string? WorkPlace { get; set; }
        public bool CheckStatus { get; set; } = false;
    }
}