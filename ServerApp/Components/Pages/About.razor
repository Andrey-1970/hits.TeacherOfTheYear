@page "/about"

@using System.Timers;

@inject NavigationManager navigate
@inject IDataService data

<PageTitle>О конкурсе</PageTitle>
<div class="block">
    <div class="block-title">
        <div class="block-title-text">
            О конкурсе
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="d-flex justify-content-center pb-4">
                <div class="circle-stage-1">
                    <div class="circle-stage-title">
                        <div class="circle-stage-number">1</div>
                    </div>
                </div>
            </div>

            <div class="block-subtitle-text text-center pb-2">
                Первый этап
                <Tooltip Title="@GetTooltipText(startFirstDeadline, endFirstDeadline)"
                         Placement="TooltipPlacement.Bottom">
                    <Icon Name="IconName.InfoCircle" />
                </Tooltip>
            </div>
            
            <div class="form-text text-center">Прием заявок</div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="d-flex justify-content-center pb-4">
                <div class="circle-stage-2">
                    <div class="circle-stage-title">
                        <div class="circle-stage-number">2</div>
                    </div>
                </div>
            </div>

            <div class="block-subtitle-text text-center pb-2">
                Второй этап
                <Tooltip Title="@GetTooltipText(startSecondDeadline, endSecondDeadline)"
                         Placement="TooltipPlacement.Bottom">
                    <Icon Name="IconName.InfoCircle" />
                </Tooltip>
            </div>

            <div class="form-text text-center">Экспертиза заявок и документов</div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="d-flex justify-content-center pb-4">
                <div class="circle-stage-3">
                    <div class="circle-stage-title">
                        <div class="circle-stage-number">3</div>
                    </div>
                </div>
            </div>

            <div class="block-subtitle-text text-center pb-2">
                Третий этап
                <Tooltip Title="не позднее 30.11.2024. Награждение победителей – 05.12.2024"
                         Placement="TooltipPlacement.Bottom">
                    <Icon Name="IconName.InfoCircle" />
                </Tooltip>
            </div>

            <div class="form-text text-center">Оценка заявок и присуждение премий Советом конкурса</div>
        </div>
    </div>

    <div class="d-flex flex-column">
        @if (targetDate == startFirstDeadline)
        {
            <div class="block-title-text text-center mb-3">До начала приема заявок осталось:</div>
            <div class="countdown mb-3">
                <div class="countdown-item">
                    <span id="days">@days</span>
                    <span class="label">Дней</span>
                </div>
                <div class="countdown-item">
                    <span id="hours">@hours</span>
                    <span class="label">Часов</span>
                </div>
                <div class="countdown-item">
                    <span id="minutes">@minutes</span>
                    <span class="label">Минут</span>
                </div>
            </div>
        }
        else if (targetDate == endFirstDeadline)
        {
            <div class="block-title-text text-center mb-3">До конца приема заявок осталось:</div>
            <div class="countdown mb-3">
                <div class="countdown-item">
                    <span id="days">@days</span>
                    <span class="label">Дней</span>
                </div>
                <div class="countdown-item">
                    <span id="hours">@hours</span>
                    <span class="label">Часов</span>
                </div>
                <div class="countdown-item">
                    <span id="minutes">@minutes</span>
                    <span class="label">Минут</span>
                </div>
            </div>
            <div class="d-flex flex-wrap gap-2 justify-content-center mb-3">
                <AuthorizeView>
                    <NotAuthorized>
                        <Button Type="ButtonType.Link"
                                Color="ButtonColor.Primary"
                                @onclick="ShowConfirmationAsync">
                            Подать заявку на участие
                        </Button>
                    </NotAuthorized>
                    <Authorized>
                        <Button Type="ButtonType.Link"
                                Color="ButtonColor.Primary"
                                To="/application-form#">
                            Подать заявку на участие
                        </Button>
                    </Authorized>
                </AuthorizeView>
            </div>
        }
        else if (targetDate == endSecondDeadline)
        {
            <div class="block-title-text text-center mb-3">До конца голосования осталось:</div>
            <div class="countdown mb-3">
                <div class="countdown-item">
                    <span id="days">@days</span>
                    <span class="label">Дней</span>
                </div>
                <div class="countdown-item">
                    <span id="hours">@hours</span>
                    <span class="label">Часов</span>
                </div>
                <div class="countdown-item">
                    <span id="minutes">@minutes</span>
                    <span class="label">Минут</span>
                </div>
            </div>
            <div class="d-flex flex-wrap gap-2 justify-content-center mb-3">
                <Button Type="ButtonType.Link"
                        Color="ButtonColor.Primary"
                        To="/voting#">
                    К голосованию
                </Button>
            </div>
        }
        else if (dateNow > endSecondDeadline)
        {
            <div class="block-title-text text-center mb-3">Ожидайте оглашения итогов конкурса</div>
        }
    </div>

    <ConfirmDialog @ref="dialog" />

    <div class="d-flex p-3">
        <div class="w-100">
            <div class="block-content-text" style="margin-right: 1.5vw;">
                <p>
                    Федеральное государственное бюджетное образовательное учреждение высшего образования «Тюменский индустриальный университет» 
                    в рамках реализации мероприятий, посвященных празднованию 60-летия Университета проводит в 2024 году конкурс на соискание премий 
                    в области научно-педагогической и научно-исследовательской деятельности (далее – конкурс).
                </p>

                <p>Премии присуждаются по следующим в области научно-педагогической и научно-исследовательской деятельности направлениям:</p>
                <div class="block-subtitle-text fs-6">СТРОИТЕЛЬСТВО И АРХИТЕКТУРА</div>
                <p style="text-indent:30px;">07.00.00. Архитектура</p>
                <p style="text-indent:30px;"> 08.00.00. Техника и технологии строительства</p>
                <p style="text-indent:30px;"> 2.1. Строительство и архитектура</p>
                <div class="block-subtitle-text fs-6">ЭНЕРГЕТИКА И НЕФТЕГАЗОВАЯ ИНДУСТРИЯ</div>
                <p style="text-indent:30px;"> 13.00.00. Электро- и теплоэнергетика</p>
                <p style="text-indent:30px;"> 21.00.00. Прикладная геология, горное дело, нефтегазовое дело и геодезия</p>
                <p style="text-indent:30px;"> 2.8. Недропользование и горные науки</p>

                <p>В качестве <strong>участников</strong> конкурса могут выступать подавшие заявки на участие в конкурсе:</p>
                <p>
                    <Icon Name="IconName.ArrowRightShort" Size="IconSize.x5" Color="IconColor.Primary" />
                    докторанты и работники высших учебных заведений, отраслевых и академических институтов, работники сектора промышленности (исследователи), 
                    осуществляющие научно-исследовательскую и/или научно-педагогическую деятельность, имеющие ученую степень кандидата наук и/или доктора наук;
                </p>
                <p>
                    <Icon Name="IconName.ArrowRightShort" Size="IconSize.x5" Color="IconColor.Primary" /> 
                    работники высших учебных заведений, отраслевых и академических институтов, – лица, занимающие штатные научные и(или) педагогические 
                    должности в высших учебных заведениях, отраслевых и академических институтах;
                </p>
                <p>
                    <Icon Name="IconName.ArrowRightShort" Size="IconSize.x5" Color="IconColor.Primary" /> 
                    исследователи – работники, профессионально занимающиеся исследованиями и разработками и непосредственно осуществляющие создание новых знаний, 
                    продуктов, методов и систем, а также управление указанными видами деятельности.
                </p>
            </div>
        </div>
    </div>
</div>


<!-- !!!!!!!!!!!!!!!!!!!!!!!!!  БЛОК ПОЛОЖЕНИЕ КОНКУРСА -->

<div class="block-title">
    <div class="block-title-text">
        Положение конкурса
    </div>
</div>
<div class="block-content">
    <div class="block-content-text">
        <p>Каждый участник конкурса может подать <strong>не более одной заявки</strong> в одно из направлений деятельности. Не принимаются заявки от авторских коллективов.</p>

        <p>По запросу организаторов конкурса, участник конкурса предоставляет следующие <strong>документы</strong>:</p>

        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            документ, удостоверяющий личность участника конкурса (2 и 3 страница паспорта) или временное удостоверение личности, выданное на период его замены;
        </p>
        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            справка с места работы участника конкурса, где осуществляет трудовую деятельность, заверенная подписью руководителя
            (уполномоченного лица) организации и оттиском печати (при наличии печати);
        </p>
        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            копия диплома участника конкурса о присуждении ученой степени кандидата/доктора наук;
        </p>
        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            копия аттестата участника конкурса о присвоении ученого звания.
        </p>

        <p>На конкурс может быть представлена <strong>наиболее значимая работа</strong> участника конкурса по выбранному направлению:</p>
        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            учебник или учебное пособие;
        </p>
        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            онлайн (электронный) курс, практический курс (практикум);
        </p>
        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            учебно-методическое пособие (комплект), методическое указание (руководство) или иной учебно-методический труд, в соответствии со структурой учебно-методического комплекса;
        </p>
        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            цикл научных, научно-практических или исследовательских разработок;
        </p>
        <p>
            <Icon Name="IconName.DashLg" Size="IconSize.x5" Color="IconColor.Primary" />
            монография или цикл монографических исследований или иной результат научно-исследовательской деятельности.
        </p>

        <p>
            Материалы, представленные в наиболее значимой работе, должны быть оригинальными. Использование участниками конкурса материалов,
            полученных другими исследователями, без соответствующей ссылки на источник (плагиат), а также повторное представление материалов,
            ранее подававшихся на конкурсы, проводимые ТИУ, в составе заявок на участие в конкурсах, вошедших в число победителей таких конкурсов, <strong>не допускается</strong>.
        </p>
        <p>
            <strong>Не допускается</strong> представление на конкурс материалов, составляющих основу заявки, направляемой для участия в любом ином конкурсе, проводимом ТИУ.
        </p>
        <p>
            Достоверность данных, представленных в заявках, верифицируется по победителям конкурса.
        </p>
        <p>
            Подавая заявку на участие, участник конкурса подтверждает достоверность указанных в заявке данных, ознакомлен и согласен с условиями участия в конкурсе.
            Оргкомитет вправе направить запросы организациям, в которых осуществляют трудовую деятельность участники конкурса, с целью проверки достоверности сведений,
            представленных участниками конкурса.
        </p>
    </div>
</div>

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!  БЛОК ПРИЗОВ -->

<div class="block-title">
    <div class="block-title-text">
        Призы
    </div>
</div>
<div class="block-content">
    <div class="block-content-text">
        <p>Награждение победителей – 05.12.2024</p>
        <p>Победителям будут вручаться денежные вознаграждения, размер которого устанавливается дополнительно, а также диплом лауреата Премии, сертификат Премии, диплом Премии.</p>
    </div>
</div>

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!  БЛОК ЗАДАЧ -->
<div class="block-title">
    <div class="block-title-text">
        Задачи конкурса
    </div>
</div>
<div class="block-content">
    <div class="block-content-text" style="margin-right: 1.5vw;">
        <p>Конкурс проводится в целях:</p>
        <p><Icon Name="IconName.Check" Size="IconSize.x5" Color="IconColor.Primary" /> выявления и поощрения лучших представителей профессионального сообщества для мотивации их профессионального роста; </p>
        <p><Icon Name="IconName.Check" Size="IconSize.x5" Color="IconColor.Primary" /> воспроизводства научно-педагогических кадров; </p>
        <p><Icon Name="IconName.Check" Size="IconSize.x5" Color="IconColor.Primary" /> совершенствования научно-методического обеспечения деятельности системы высшего образования; </p>
        <p><Icon Name="IconName.Check" Size="IconSize.x5" Color="IconColor.Primary" /> обмена лучшими практиками и опытом.</p>
    </div>
</div>

@code {
    private DateTimeOffset targetDate = new();

    private string? days;
    private string? hours;
    private string? minutes;

    private Timer? timer;

    private ConfirmDialog? dialog;

    DateTimeOffset startFirstDeadline = new();
    DateTimeOffset endFirstDeadline = new();
    DateTimeOffset startSecondDeadline = new();
    DateTimeOffset endSecondDeadline = new();
    DateTimeOffset dateNow = new();

    protected override async Task OnInitializedAsync()
    {
        timer = new Timer(1000); // Таймер обновляется каждую секунду
        timer.Elapsed += UpdateCountdown!; // Событие для обновления таймера
        timer.Start(); // Запуск таймера

        // Устанавливаем текущее время в московском часовом поясе
        dateNow = DateTimeOffset.UtcNow.ToOffset(TimeSpan.FromHours(3));
        Data.Entities.Deadline deadlineFirst = await data.GetDeadlineAsync("Прием заявок");
        if (deadlineFirst != null)
        {
            startFirstDeadline = deadlineFirst.Start.ToOffset(TimeSpan.FromHours(3));
            endFirstDeadline = deadlineFirst.End.ToOffset(TimeSpan.FromHours(3));
        }

        Data.Entities.Deadline deadlineSecond = await data.GetDeadlineAsync("Голосование");
        if (deadlineSecond != null)
        {
            startSecondDeadline = deadlineSecond.Start.ToOffset(TimeSpan.FromHours(3));
            endSecondDeadline = deadlineSecond.End.ToOffset(TimeSpan.FromHours(3));
        }

        targetDate = startFirstDeadline;
    }

    private string GetTooltipText(DateTimeOffset start, DateTimeOffset end)
    {
        return $"с {TimeOnly.FromDateTime(start.DateTime)} МСК {start.Day:D2}.{start.Month:D2}.{start.Year} по {TimeOnly.FromDateTime(end.DateTime)} МСК {end.Day:D2}.{end.Month:D2}.{end.Year}"; 
    }

    private async Task ShowConfirmationAsync()
    {
        var options = new ConfirmDialogOptions
            {
                IsVerticallyCentered = true,
                NoButtonText = "Нет",
                YesButtonText = "Да",
            };
        var confirmation = await dialog!.ShowAsync(
            title: "Подтвердите действие",
            message1: "Для подачи заявки на участие необходима авторизация на сайте.",
            message2: "Перейти на страницу авторизации?",
            confirmDialogOptions: options);

        if (confirmation)
        {
            navigate.NavigateTo("/application-form#");
        }
    }

    private void UpdateCountdown(object sender, ElapsedEventArgs e)
    {
        TimeSpan remainingTime = targetDate - dateNow;

        // Проверка завершения отсчета
        if (remainingTime.TotalSeconds >= 0)
        {
            days = remainingTime.Days.ToString("D2");
            hours = remainingTime.Hours.ToString("D2");
            minutes = remainingTime.Minutes.ToString("D2");

            // Обновление UI
            InvokeAsync(StateHasChanged);
        }
        else if (targetDate == startFirstDeadline)
        {
            // Остановка таймера, если отсчет завершен
            timer!.Stop();

            targetDate = endFirstDeadline;

            // Перезапуск таймера
            timer.Start();
        }
        else if (targetDate == endFirstDeadline)
        {
            // Остановка таймера, если отсчет завершен
            timer!.Stop();

            targetDate = endSecondDeadline;

            // Перезапуск таймера
            timer.Start();
        }
        else
        {
            timer!.Stop();
        }
    }
}